---
title: DNS挟持，到处投毒，开启一个wifi热点，让很多人来链接，然后控制他们
tags: 信息安全
categories: 信息安全
abbrlink: c1f58338
date: 2020-06-19 14:43:59
---

### 写在前面的话：

以下的内容，请作为技术交流，不要去搞违法乱纪的事情，周五下班看到的群里一个哥们儿说道手机刷了linux，ssh去写代码，然后想到自己曾经也搞过arm版的linux到手机上，然后又想到曾经用了一个20g的密码字典使用8187去偷隔壁wifi，然后又想到自己的东西大部分在成都，就带了几个板子，这边没有玩的，一个人在北京空虚寂寞冷，于是就找点玩的，于是就想到我开个wifi热点，让别人都链接，然后控制他们，控制他们，控制他们，所以先在家里试验一把管用不，我不会说我去kfc抓到了什么。。0.0.
 
<!-- more -->
 
ps：当你要干这件事情的时候，请准备一个可以开启热点的本本，同时请准备两张网卡，因为一个网卡只能处于一种模式，必须一个提供ap功能，一个去链接外网。
 
 
Ps：以下内容可能不是完全，我减省了很多步骤，毕竟，这玩意儿要写出来也挺痛苦的。挺多的，动手试试就知道了。所以只留下了思路和过程，省掉了编码的过程。
 
ps：该思路并非我原创，借鉴了很多前辈的经验，只是自己将他实施了一把，过了一次动手的瘾，同时加了点自己的东西。
 
Ps：内容可能写的不好过于难懂，慢慢看下去还是蛮好玩的，有啥问题，欢迎交流。。
 
白发川
2015年6月13日 13:36
 
 
### 下面，高清无码大图：
 
![image](d001.png)

 
* computer：一个正常的用户（可以是手机，平板任意设备，我这里用虚拟机模拟了），链接到hack的wifi热点，也就是日常生活中找出找wifi链接那拨人。
 
* oracle：正常的服务器，提供dns, dhcp, web服务，能够成功解析www.bfc.com的域名，固定ip:192.168.59.1（59是我大学的学号，特喜欢这个数字），这里我模拟的是internet。
 
* hack：一个提供热点wifi的hack，分配到oracle服务器的ip：192.168.59.3，它就是用来挟持用户dns的家伙。
 
我要实现的效果：当computer（链接到wifi热点那拨人）访问任何信息，都是由hack去代理访问，然后hack在内容里面插入木马，再把内容返回给computer，实现永久控制computer（至于如何永久，我最后会提到），这时候computer完全不知道他访问的内容已经被人做了手脚，还屁颠屁颠的乐着wifi速度真快。。

 
搭建服务器：这一个步骤不是必须，但是我是为了完整的系统模拟，所以我把所有的客户端的网址，和所有的dns解析，全部我自己做了，所以我的这个模拟过程是最难的，因为我把整个internet都模拟了，而实际中你去搞别人，只需要提供你的hack代理就行了，走3g网络，等等就能上internet，但是搭建dns这些服务是很好玩的，所以我搭建了一个基于linux的服务器，它提供dhcp服务器，用来给hack上网，提供dns服务，用来解析客户端过来的ip，同时它上面部署了一套web服务器。用于客户端访问。如下图所示：
 
![image](d002.png)

在这里我们能够看到oracle服务器已经能够成功的提供dns解析服务了。
 
搭建hack服务器：这个地方很重要了，因为真正的服务器是oracle，而hack只是做一个代理，所以hack必须让其他客户端把dns指向自己，这样才能做域名挟持，于是hack开启一个wifi热点，让广大用户来链接，但是有一个前提就是让广大用户能够成功上网自己必须能够成功上网，如果别人链接一个wifi却不能上网，肯定就不会链接了，所以hack首先要链接到oracle，得到它的ip：

![image](d003.png)

好，我们的hack已经链接网络了，并且oracle服务器上也能够看到hack已经成功链接了：

![image](d004.png)
 

这时候hack是能够成功访问我们的正常服务器的：

![image](d005.png)


并且这个页面才是真正的没有被投毒的页面，那么接下来我们就要开始做代理了，我们要干一件事，那就是别人访问页面的时候，我们帮他访问，同时我们还要插入我们自己的脚本，首先我们定义一个配置文件，在里面放入我们要注入的木马脚本：


![image](d006.png)

 
也就是当用户访问任意页面的时候，我们都把这个脚本注入进去，那么用户的页面就会比真正的页面多两句：

```shell
<script>
```

这里面就是我们的脚本js，现在这两文件是空的，后面我会加东西。
 
所以当我们的hack完成以下事情：

* 编写好监听80端口，443端口，53（dns解析端口）端口的脚本。
* 能够代理访问
* 能够开启wifi热点
 
当以上三点你完成后，那么尽情的开启wifi热点，让别人来链接你吧。但是如果你的wifi不设置密码，很多人是不会连的，这点常识很多人还是有的，那么你可以去kfc，然后把名字和密码全部修改成kfc的用户名和密码，放心吧，大部分人会链接的，或者去如家酒店住一晚，有很多意外收获的。。0.0.
 
 
### 有人上钩了：
 
当有人链接到hack提供的wifi的时候，他的的信息是这样的：
 
![image](d007.png)

他的dns已经变成hack的ip了，也就是只要他链接hack的wifi热点，他的dns就被挟持了。
 
这时候他的一举一动，全部被人盯在眼里，于是当computer（链接wifi那一拨人）尝试访问www.bfc.com这个东西的时候，实际上是hack在帮他访问，我们在computer的浏览器打开www.bfc.com这个网址：

![image](d008.png)

看起来好像是一模一样，但是我们通过查看源码，我们能够发现多了一些东西：

![image](d009.png) 
 
yes，这就是我们的木马，不知不觉中我们就添加给用户的页面了，他还什么都不知道，这时候我们在hack的控制台是可以看到computer的一举一动的：
 
![image](d010.png)
 
但是computer页面上却没有任何异常，因为我的js是空的，为了验证注入是生效了的，我现在修改服务器的bfc.js：
 
![image](d012.png) 

加一句话表示我看上你了。然后当computer再次上网的时候，一个友好的信息告诉你：
 
 
![image](d013.png)
 
 
 到这里我们已经完全挟持了用户，你想干嘛就干嘛了。。
 
 
然后回到开始题目的上的永久控制它，这几天在联想解决bug，有一个js我在服务上已经更新了，但是很多人的本地死活就是之前的，必须清空缓存才能生效，也就是说，这些js是会被缓存的，那么只需要找到那些常用网站很久不更新的东西，然后在里面插入我们的代码，这样这个js被本地缓存了，不管以后什么时候，只要它再次访问这个js，然后就能找到它了。。

