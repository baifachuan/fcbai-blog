---
title: 关于此博客的评论服务
tags: 编程基础
categories: 编程基础
abbrlink: c589a2d2
date: 2021-11-30 12:03:57
---

这个博客的theme是我从一个国外的博客主题进行精简，然后仿照hacker news的风格进行了修改而来，开始的时候没有添加评论功能，后来想着这个功能聊胜于无，于是又给加了。
不过添加博客也算是一路折腾，开始我用的是disqus，disqus的坏处就是需要翻墙，不过想来对于搞技术的来说，这不算是难事，甚至算是入门基本功，也就保留了，可惜好景不长。
一段时间后disqus不可用，看了下据说是不提供评论服务了，于是我又去看了下gitment，gitment使用git rep作为评论保留的地方，以issues的形式记录每一个评论。

不过通过issues的形式去记录评论意味着需要通过github的api去发起issue，而github的api又有着CORS的限制，所以需要做一些代理转发。

我用的 `https://github.com/imsun/gitment` 这个代码仓库构建的评论，这个代码仓库的作者提供了一个地址 `gh-oauth.imsun.net` 作为转发服务器，不过该服务器经常不稳定。

虽然不咋使用，但是服务器不稳定也是头疼，于是我看了下这个服务的代码，具体的源码在：`https://github.com/imsun/gh-oauth-server`。

搭建该服务器需要https协议，刚好我自己搞的服务器本身就是https，于是就复用了ssl的key，直接修改了一下这个上面的代码，把ssl的信息添加进去，最后修改的地方为：

修改`gitment.browser.js`文件的3416行将`https://gh-oauth.imsun.net/`替换成：`https://baifachuan.com:8443/`

原样的部署了一套这个server，作为自己的服务的代理，修改代码结果：

```
      _utils.http.post('https://www.baifachuan.com:8443', {
        code: code,
        client_id: client_id,
        client_secret: client_secret
      }, '').then(function (data) {
        _this.accessToken = data.access_token;
        _this.update();
      }).catch(function (e) {
        _this.state.user.isLoggingIn = false;
        alert(e);
      });
    } else {
      this.update();
    }
```

这样的话自己的服务器自己转发，也就省去了不稳定的情况。
